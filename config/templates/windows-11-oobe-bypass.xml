<?xml version="1.0" encoding="utf-8"?>
<!--
  Windows 11 OOBE Bypass - Autounattend.xml

  Bypasses Windows 11 OOBE requirements:
  - Skips network/internet requirement
  - Allows local account (no Microsoft account required)
  - Skips privacy screens and other OOBE prompts

  Place in root of Windows installation media (alongside setup.exe).
  The prepare-images.sh script copies this automatically for Windows 10/11.
-->
<unattend xmlns="urn:schemas-microsoft-com:unattend">

    <!-- OOBE (Out-of-Box Experience) Settings -->
    <settings pass="oobeSystem">
        <component name="Microsoft-Windows-Shell-Setup"
                   processorArchitecture="amd64"
                   publicKeyToken="31bf3856ad364e35"
                   language="neutral"
                   versionScope="nonSxS"
                   xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

            <OOBE>
                <!-- Skip network requirement (the main Win11 annoyance) -->
                <HideOnlineAccountScreens>true</HideOnlineAccountScreens>
                <HideWirelessSetupInOOBE>true</HideWirelessSetupInOOBE>

                <!-- Skip other OOBE screens -->
                <HideEULAPage>true</HideEULAPage>
                <HideLocalAccountScreen>false</HideLocalAccountScreen>
                <HideOEMRegistrationScreen>true</HideOEMRegistrationScreen>
                <SkipMachineOOBE>false</SkipMachineOOBE>
                <SkipUserOOBE>false</SkipUserOOBE>

                <!-- Privacy settings - disable telemetry prompts -->
                <ProtectYourPC>3</ProtectYourPC>
            </OOBE>

            <!-- Optional: Create a default local admin account -->
            <!-- Uncomment and modify if you want auto-created user -->
            <!--
            <UserAccounts>
                <LocalAccounts>
                    <LocalAccount wcm:action="add">
                        <Name>Admin</Name>
                        <Group>Administrators</Group>
                        <Password>
                            <Value></Value>
                            <PlainText>true</PlainText>
                        </Password>
                    </LocalAccount>
                </LocalAccounts>
            </UserAccounts>
            -->

        </component>

        <!-- International settings - user will still choose during OOBE -->
        <component name="Microsoft-Windows-International-Core"
                   processorArchitecture="amd64"
                   publicKeyToken="31bf3856ad364e35"
                   language="neutral"
                   versionScope="nonSxS"
                   xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
            <!-- Leave empty to let user choose locale during OOBE -->
        </component>

    </settings>

    <!-- Specialize pass - runs after image is applied -->
    <settings pass="specialize">
        <component name="Microsoft-Windows-Deployment"
                   processorArchitecture="amd64"
                   publicKeyToken="31bf3856ad364e35"
                   language="neutral"
                   versionScope="nonSxS"
                   xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
            <RunSynchronous>
                <RunSynchronousCommand wcm:action="add">
                    <Order>1</Order>
                    <!-- Bypass network requirement via registry (belt and suspenders) -->
                    <Path>reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\OOBE /v BypassNRO /t REG_DWORD /d 1 /f</Path>
                </RunSynchronousCommand>
            </RunSynchronous>
        </component>
    </settings>

</unattend>
